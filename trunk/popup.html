<style>
body {
  min-width:357px;
  overflow-x:hidden;
  font-size:8pt;
}

img {
  margin:5px;
  border:2px solid black;
  vertical-align:middle;
  width:75px;
  height:75px;
}
</style>
<link type="text/css" rel="stylesheet" href="ui-lightness/jquery-ui-1.7.2.custom.css">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
<script>
	
	
	$(function() {
			$("#datepicker").datepicker({
					dateFormat: "yymmdd",
					firstDay: 1, 
					changeFirstDay: false,
					onSelect : function (dateText) {
						console.log("date selected : " + dateText);
						chrome.tabs.getSelected(focusedWindowId, 
									function ( tab) {
										chrome.extension.getBackgroundPage().STORAGE.addTickleTab(dateText, tab.url, tab.title);
										// close tab
										try {
											chrome.tabs.remove(tab.id);
										} catch (e) {
											alert(e);
										}
										// close self
										window.close();
									}
								);
					}					
			});
		$("#accordion").accordion({
			autoHeight: false,
			event: "mouseover"
		});
	});

	var focusedWindowId = undefined;
	var currentWindowId = undefined;

	function onLoad() {
		chrome.windows.getCurrent(function(currentWindow) {
				currentWindowId = currentWindow.id;
				chrome.windows.getLastFocused(function(focusedWindow) {
						focusedWindowId = focusedWindow.id;
						// loadWindowList();
				});
		});
		updateTodayList();
	};

	function getCurrentDateAsKey() {
		var d = new Date();
		var dd = d.getDate();
		if (dd < 10 ) {
			dd = '0' + dd;
		}
		var mm = d.getMonth() + 1;
		if (mm < 10) {
			mm = '0' + mm;
		}
		return d.getFullYear() + '' + mm +'' +  dd;
	};

	function updateTodayList() {
		var dt = getCurrentDateAsKey();
		console.log("current date " + dt);
		var a = chrome.extension.getBackgroundPage().STORAGE.getTickleTabs(dt);
		
		var t = "";
	
		for(var i = 0, l = a.length; i < l; i++ ) {
			// key -> [{url, title}]
			var b = a[i].value;
			
			for(var ii = 0, ll = b.length; ii < ll; ii++ ) {
			// key -> [{url, title}]
				var y = b[ii];
				t +=['<li><a href="', y.url ,'">',y.title, '</a>', '</li>'].join();
			}
		}
	
		if (t == "") {
			document.getElementById("today-list-content").innerHTML = "no tabs for today";
		} else {
			document.getElementById("today-list-content").innerHTML =  t;
		}

	};
	
</script>

<body onload="onLoad()">
<div id='accordion'>
	<h3><a href='#'>Active Tabs today</a></h3>
  <div id='today-list'>
    <ul id='today-list-content'>
      <li>test</li>
    </ul>
    Open all
  </div>
  <h3><a href='#'>Close tab and show on</a></h3>
  <div id='close'>
    <ul>
      <li>GTUG (1. March 2010) (x)</li>
      <li>Birthday (25. February 2011) (x)</li>
      <li>Define new (optional): <input id="date-label" value=''></li>
    </ul>
    <div id='datepicker'></div>
  </div>
  <h3><a href='#'>Tickler Dashboard</a></h3>
  <div>
    <ul>
      <li><a href='http://www.amazon.de'>Amazon</a></li>
    </ul>
  </div>
</div>
</body>
